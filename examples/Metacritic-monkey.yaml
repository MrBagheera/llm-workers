# Demonstrates: Custom tools with statement composition, web fetching tools, inline tool definitions,
# match statements with stubbed data, LLM tool integration, template variables, UI hints
models:
  - name: default
    provider: openai
    model: gpt-4o

tools:
  - name: _search_movie_on_metacritic_stub
    description: >
      (debug) Searches for the Metacritic score for a given movie title. Returns text from Metacritic web site,
      containing the list of possible matches (movie title, release year, score).
    input:
      - name: movie_title
        description: Movie title
        type: str
    body:
      match: "{movie_title}"
      matchers:
        - case: "Soul"
          then:
            result: |         
              Soul
              
              movie
              2020
              83
              
              The Story of Souleyman
              
              movie
              2024
              81
              
              Summer of Soul (...Or, When the Revolution Could Not Be Televised)
              
              movie
              2021
              96
              
              Lost Soulz
              
              movie
              2023
              74
              
              Dead Souls
              
              movie
              2018
              89
              
        - case: "Wallace & Gromit: The Curse of the Were-Rabbit"
          then:
            result: |
              Wallace & Gromit: The Curse of the Were-Rabbit
                
                movie
                2005
                87
              
              Pirates of the Caribbean: The Curse of the Black Pearl
                
                movie
                2003
                63
              
              Wallace & Gromit: Vengeance Most Fowl
                
                movie
                2024
                83
                
        - case: "The Incredibles"
          then:
            result: |  
              The Incredibles
              
              movie
              2004
              90
              
              Incredibles 2
              
              movie
              2018
              80
            
              The Squid and the Whale
              
              movie
              2005
              82

            The Witcher: Nightmare of the Wolf
              
              movie
              2021
              67
      default:
        - call:
            name: _user_input
            import_from: llm_workers.tools.misc.UserInputTool
          params:
            prompt: "Movie '{movie_title}' not found in stub data. Please provide mock Metacritic search results (movie titles, years, and scores):"

  - name: metacritic_monkey
    description: >
      Finds the Metacritic score for a given movie title and year. Returns either a single number or "N/A" if the movie is not found.
    input:
      - name: movie_title
        description: Movie title
        type: str
      - name: movie_year
        description: Movie release year
        type: int
    ui_hint: Looking up Metacritic score for movie "{movie_title}" ({movie_year})
    body:
      - call:
          name: _fetch_page_text
          import_from: llm_workers.tools.fetch.FetchPageTextTool
        params:
          url: "https://www.metacritic.com/search/{movie_title}/?page=1&category=2"
          xpath: "//*[@class=\"c-pageSiteSearch-results\"]"
#      - call: _search_movie_on_metacritic_stub
#        params:
#          movie_title: "{movie_title}"
      - call:
          name: _extract_score_from_search_results
          import_from: llm_workers.tools.llm_tool.build_llm_tool
          ui_hint: Extracting Metacritic score from search results
        params:
          prompt: >
            Find Metacritic score for movie "{movie_title}" released in {movie_year}.
            To do so:
              - From the list of possible matches, chose the one matching movie title and year and return metacritic score as single number
              - If no matching movie is found, respond with just "N/A" (without quotes)
              - DO NOT provide any additional information in the response
            
            Possible matches:
            {output0}

chat:
  default_prompt: Please find metacritic score for the movie "Soul" (2020).
